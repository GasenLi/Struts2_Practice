<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生查询</title>

</head>

<body>
    <div id="main" >
        <form id="SearchBar" style="margin-bottom: 20px; margin-left: 38%; margin-top: 11%">
            <span>属性</span>

            <select id="menu" name="menu">
                <option value ="name">姓名</option>
                <option value ="age">年龄</option>
                <option value="sno">学号</option>
            </select>

            <select id="range" name="range">
                <option value ="include">包含</option>
                <option value ="equal">等于</option>
            </select>

            <input size="30" name="value" value="王">

            <button id="search">查询</button>
        </form>

        <table id="result" border="2" width="700" style="margin-left: 34%">
            <thead>
                <tr style="background-color:#000000; color:#FFFFFF">
                    <th class="tableLeft">学号</th>
                    <th class="tableLeft">姓名</th>
                    <th class="tableRight">年龄</th>
                </tr>
            </thead>
            <tbody id="tbody">
                <tr>
                    <th>1</th>
                    <th>2</th>
                    <th>3</th>
                </tr>
            </tbody>
        </table>
    </div>
</body>

<style>
    .tableCenter {
        text-align: center;
    }
    .tableLeft{
        text-align: left;
    }
    .tableRight {
        text-align: right;
    }


</style>

<script src="./Util/jquery-3.2.1.js" type="text/javascript" charset="utf-8"></script>

<script type="text/javascript">
    //校验是否登陆
    function checkIsLogged(d) {
        var info = d['info'];
        console.log(info);
        if (info == 'notLoggedIn'){
            self.location='Login.html';
        }
    }

    //查询
    function search(e) {
        var formData = $("#SearchBar").serialize();
        console.log(formData);

        $.ajax({
            type : "post",
            url : '/SQ/StudentQuery.action',
            data : formData,
            dataType:"json",
            success : function(d) {
                console.log("成功",d);
                checkIsLogged(d);

                //动态生成表单
                var tbody = $("#tbody");
                tbody.html("");
                for(var i=0;i<d.length;i++){
                    tbody.append("<tr> <th class='tableLeft'>"+ d[i][0] +"</th> <th class='tableLeft'>"+ d[i][1] +"</th> <th class='tableRight'>"+ d[i][2] +"</th> </tr>");
                }

                tbody.append("<tr> <th colspan='3'> 共"+ d.length +"人</th> </tr>");

            },
            error : function(d) {
                console.log("异常",d);
                alert("异常"+JSON.stringify(d))
            }
        });
    }
    
    $(function() {
        $("#search").click(function(e) {
            e.preventDefault();
            search();
        });
    });

    $(document).ready(function () {
        search();

        $("#menu").bind("change",function(){
            console.log(this.value);
            if(this.value=='age'){
                $("#range").html("<option value ='greater'>大于</option>" +
                    "<option value ='gore'>大于等于</option>" +
                    "<option value='equal'>等于</option>" +
                    "<option value='sore'>小于等于</option>" +
                    "<option value='smaller'>小于</option>")
            }
            else{
                $("#range").html(" <option value ='include'>包含</option>" +
                    "<option value='equal'>等于</option>")
            }
        });
    });
</script>
</html>